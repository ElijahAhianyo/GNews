# Gnews Utils

[_Documentation generated by Documatic_](https://www.documatic.com)

<!---Documatic-section-Codebase Structure-start--->
## Codebase Structure

<!---Documatic-block-system_architecture-start--->
```mermaid
None
```
<!---Documatic-block-system_architecture-end--->

# #
<!---Documatic-section-Codebase Structure-end--->

<!---Documatic-section-gnews.utils.utils.lang_mapping-start--->
## [gnews.utils.utils.lang_mapping](3-gnews_utils.md#gnews.utils.utils.lang_mapping)

<!---Documatic-section-lang_mapping-start--->
<!---Documatic-block-gnews.utils.utils.lang_mapping-start--->
<details>
	<summary><code>gnews.utils.utils.lang_mapping</code> code snippet</summary>

```python
def lang_mapping(lang):
    return AVAILABLE_LANGUAGES.get(lang)
```
</details>
<!---Documatic-block-gnews.utils.utils.lang_mapping-end--->
<!---Documatic-section-lang_mapping-end--->

# #
<!---Documatic-section-gnews.utils.utils.lang_mapping-end--->

<!---Documatic-section-gnews.utils.utils.country_mapping-start--->
## [gnews.utils.utils.country_mapping](3-gnews_utils.md#gnews.utils.utils.country_mapping)

<!---Documatic-section-country_mapping-start--->
<!---Documatic-block-gnews.utils.utils.country_mapping-start--->
<details>
	<summary><code>gnews.utils.utils.country_mapping</code> code snippet</summary>

```python
def country_mapping(country):
    return AVAILABLE_COUNTRIES.get(country)
```
</details>
<!---Documatic-block-gnews.utils.utils.country_mapping-end--->
<!---Documatic-section-country_mapping-end--->

# #
<!---Documatic-section-gnews.utils.utils.country_mapping-end--->

<!---Documatic-section-gnews.utils.utils.connect_database-start--->
## [gnews.utils.utils.connect_database](3-gnews_utils.md#gnews.utils.utils.connect_database)

<!---Documatic-section-connect_database-start--->
<!---Documatic-block-gnews.utils.utils.connect_database-start--->
<details>
	<summary><code>gnews.utils.utils.connect_database</code> code snippet</summary>

```python
def connect_database(db_user, db_pw, db_name, collection_name):
    try:
        cluster = MongoClient('mongodb+srv://' + db_user + ':' + db_pw + '@gnews.stjap.mongodb.net/' + db_name + '?retryWrites=true&w=majority')
        db = cluster[db_name]
        collection = db[collection_name]
        return collection
    except Exception as e:
        print('Connection Error.', e)
```
</details>
<!---Documatic-block-gnews.utils.utils.connect_database-end--->
<!---Documatic-section-connect_database-end--->

# #
<!---Documatic-section-gnews.utils.utils.connect_database-end--->

<!---Documatic-section-gnews.utils.utils.post_database-start--->
## [gnews.utils.utils.post_database](3-gnews_utils.md#gnews.utils.utils.post_database)

<!---Documatic-section-post_database-start--->
<!---Documatic-block-gnews.utils.utils.post_database-start--->
<details>
	<summary><code>gnews.utils.utils.post_database</code> code snippet</summary>

```python
def post_database(collection, news):
    doc = {'_id': hashlib.sha256(str(json.dumps(news)).encode('utf-8')).hexdigest(), 'title': news['title'], 'description': news['description'], 'published_date': news['published date'], 'url': news['url'], 'publisher': news['publisher']}
    try:
        collection.update_one(doc, {'$set': doc}, upsert=True)
    except pymongo.errors.DuplicateKeyError:
        logging.error('Posting to database failed.')
```
</details>
<!---Documatic-block-gnews.utils.utils.post_database-end--->
<!---Documatic-section-post_database-end--->

# #
<!---Documatic-section-gnews.utils.utils.post_database-end--->

<!---Documatic-section-gnews.utils.utils.process_url-start--->
## [gnews.utils.utils.process_url](3-gnews_utils.md#gnews.utils.utils.process_url)

<!---Documatic-section-process_url-start--->
<!---Documatic-block-gnews.utils.utils.process_url-start--->
<details>
	<summary><code>gnews.utils.utils.process_url</code> code snippet</summary>

```python
def process_url(item, exclude_websites):
    source = item.get('source').get('href')
    if not all([not re.match(website, source) for website in [f'^http(s)?://(www.)?{website.lower()}.*' for website in exclude_websites]]):
        return
    url = item.get('link')
    if re.match(GOOGLE_NEWS_REGEX, url):
        url = requests.head(url).headers.get('location', url)
    return url
```
</details>
<!---Documatic-block-gnews.utils.utils.process_url-end--->
<!---Documatic-section-process_url-end--->

# #
<!---Documatic-section-gnews.utils.utils.process_url-end--->

[_Documentation generated by Documatic_](https://www.documatic.com)